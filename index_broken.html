<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>File HEX Edit - FedeKrum</title>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <div class="container mt-5">
      <div class="row">
        <div class="col-md-6 mx-auto">
          <div
            id="dropzone"
            class="border rounded p-1"
            ondragover="event.preventDefault();"
            ondrop="handleFileSelect(event);"
          >
            <p class="text-center">Drag and drop a file to edit</p>
            <div class="text-center">
              <label for="fileInput" class="btn btn-primary">
                or Select a file</label
              >
              <input
                type="file"
                id="fileInput"
                onchange="handleFileSelect(event);"
                style="display: none"
              />
              <small class="form-text text-muted"
                >file name: <span id="filename"></span> | file size:
                <span id="filelength"></span> bytes
              </small>
              <small class="form-text text-muted"
                >md5:
                <span id="md5"></span>
              </small>
            </div>
          </div>
          <div id="offset-group" class="form-group mt-4" hidden>
            <label for="offset"
              >Offset: (in hex notation, default:0) | current decimal value:
              <span id="offsetDEC">0</span></label
            >
            <input
              type="text"
              class="form-control"
              id="offset"
              name="offset"
              value="0"
            />
          </div>
          <div id="csv" class="form-group mt-4" hidden>
            <label for="values"
              >Values: (address,byte : both in hex notation) | changes:
              <span id="changes"></span
            ></label>
            <textarea
              class="form-control"
              id="values"
              name="values"
              rows="5"
            ></textarea>

            <a id="download_link" download="" href="””" hidden
              >Save edited file</a
            >

            <small id="md5HashView" class="form-text text-muted" hidden
              >md5:
              <span id="md5Hash"></span>
            </small>
          </div>
          <pre><div id="file-content"></div></pre>
        </div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/md5.min.js"></script>

    <script>
      var originalFileContent = " ";
      var originalFileName = " ";
      var origianlmd5Hash = "";

      var newFileContent = " ";
      var newlmd5Hash = "";
      var newChangesCount = 0;
      
      var pairsvalues = "";
      var csvData = "";
      
      
      var blobData;
      var offset = "0";
      var fileLength = 0;

      function updateFileView() {
        // Calculations before view refresh
        newlmd5Hash = CryptoJS.MD5(newFileContent).toString();

      }

      function updatePage() {
        // Calculations before view refresh
        newlmd5Hash = CryptoJS.MD5(newFileContent).toString();

        // view refresh
        document.getElementById("md5Hash").innerHTML = newlmd5Hash;

        if (newChangesCount > 0) {
          document.getElementById("download_link").removeAttribute("hidden");
          document.getElementById("md5HashView").removeAttribute("hidden");
        } else {
          document
            .getElementById("download_link")
            .setAttribute("hidden", "hidden");
          document
            .getElementById("md5HashView")
            .setAttribute("hidden", "hidden");
        }

        document.getElementById("changes").innerHTML = newChangesCount;
        document.getElementById("file-content").innerHTML = newFileContent;

        // ---------------- DOWNLOAD LINK GENERATOR (BLOB)
        blobData = new Blob([newFileContent], {
          type: "application/octet-stream",
        });
        url = window.URL.createObjectURL(blobData);
        document
          .getElementById("download_link")
          .setAttribute("download", originalFileName);
        document.getElementById("download_link").href = url;
      }

    </script>
  </body>
</html>
